<?php
// Script to add sample data for zone analysis testing
require_once '../config/config.php';

// Sample delivery addresses with coordinates (จังหวัดนครศรีธรรมราช อำเภอในเมือง)
$sample_addresses = [
    ['NST001', 'สมชาย เจริญสุข', '081-234-5678', '123 ถนนราชดำเนิน ตำบลในเมือง อำเภอเมือง นครศรีธรรมราช 80000', 'นครศรีธรรมราช', 'เมือง', 'ในเมือง', '80000', 8.4304, 99.9631],
    ['NST002', 'สมหญิง ใจดี', '082-345-6789', '456 ถนนพัฒนการ ตำบลในเมือง อำเภอเมือง นครศรีธรรมราช 80000', 'นครศรีธรรมราช', 'เมือง', 'ในเมือง', '80000', 8.4254, 99.9681],
    ['NST003', 'สมศักดิ์ ขยันดี', '083-456-7890', '789 ถนนเจริญเมือง ตำบลปากนคร อำเภอเมือง นครศรีธรรมราช 80000', 'นครศรีธรรมราช', 'เมือง', 'ปากนคร', '80000', 8.4354, 99.9581],
    ['NST004', 'สมใจ รักงาน', '084-567-8901', '321 ถนนราชดำเนิน ตำบลคลัง อำเภอเมือง นครศรีธรรมราช 80000', 'นครศรีธรรมราช', 'เมือง', 'คลัง', '80000', 8.4404, 99.9531],
    ['NST005', 'สมพร ขยันเรียน', '085-678-9012', '654 ถนนส่องแสง ตำบลในเมือง อำเภอเมือง นครศรีธรรมราช 80000', 'นครศรีธรรมราช', 'เมือง', 'ในเมือง', '80000', 8.4204, 99.9731],
    ['NST006', 'สมคิด ทำงาน', '086-789-0123', '987 ถนนชนะเขต ตำบลบ้านใต้ อำเภอเมือง นครศรีธรรมราช 80000', 'นครศรีธรรมราช', 'เมือง', 'บ้านใต้', '80000', 8.4154, 99.9481],
    ['NST007', 'สมปอง ใจสู้', '087-890-1234', '147 ถนนจำลอง ตำบลท่าวัง อำเภอเมือง นครศรีธรรมราช 80000', 'นครศรีธรรมราช', 'เมือง', 'ท่าวัง', '80000', 8.4454, 99.9781],
    ['NST008', 'สมบูรณ์ ใจดี', '088-901-2345', '258 ถนนราชดำเนิน ตำบลโพธิ์เสด็จ อำเภอเมือง นครศรีธรรมราช 80000', 'นครศรีธรรมราช', 'เมือง', 'โพธิ์เสด็จ', '80000', 8.4504, 99.9831],
    ['NST009', 'สมรัก ใจงาม', '089-012-3456', '369 ถนนธรรมราช ตำบลไชยา อำเภอเมือง นครศรีธรรมราช 80000', 'นครศรีธรรมราช', 'เมือง', 'ไชยา', '80000', 8.4104, 99.9881],
    ['NST010', 'สมฤทธิ์ ก้าวหน้า', '090-123-4567', '741 ถนนธานี ตำบลนาเกลียง อำเภอเมือง นครศรีธรรมราช 80000', 'นครศรีธรรมราช', 'เมือง', 'นาเกลียง', '80000', 8.4604, 99.9431],
    ['NST011', 'สมพงษ์ ขยันทำงาน', '091-234-5678', '852 ถนนมหาราช ตำบลกะปิ อำเภอเมือง นครศรีธรรมราช 80000', 'นครศรีธรรมราช', 'เมือง', 'กะปิ', '80000', 8.4654, 99.9381],
    ['NST012', 'สมหมาย ใจมั่น', '092-345-6789', '963 ถนนจำลอง ตำบลดอนทราย อำเภอเมือง นครศรีธรรมราช 80000', 'นครศรีธรรมราช', 'เมือง', 'ดอนทราย', '80000', 8.4054, 99.9931],
    ['NST013', 'สมเจตน์ ก้าวไกล', '093-456-7890', '159 ถนนคลัง ตำบลน้ำใส อำเภอเมือง นครศรีธรรมราช 80000', 'นครศรีธรรมราช', 'เมือง', 'น้ำใส', '80000', 8.4704, 99.9981],
    ['NST014', 'สมเดช ใจยุติธรรม', '094-567-8901', '753 ถนนเสด็จ ตำบลท่าเรือ อำเภอเมือง นครศรีธรรมราช 80000', 'นครศรีธรรมราช', 'เมือง', 'ท่าเรือ', '80000', 8.4754, 99.9331],
    ['NST015', 'สมเดือน ใจซื่อ', '095-678-9012', '357 ถนนเทพนคร ตำบลไทรบุรี อำเภอเมือง นครศรีธรรมราช 80000', 'นครศรีธรรมราช', 'เมือง', 'ไทรบุรี', '80000', 8.4004, 99.9081],
    ['NST016', 'สมยศ ใจกล้า', '096-789-0123', '159 ถนนสำโรง ตำบลกะเปา อำเภอเมือง นครศรีธรรมราช 80000', 'นครศรีธรรมราช', 'เมือง', 'กะเปา', '80000', 8.4804, 99.9131],
    ['NST017', 'สมาน ใจสงบ', '097-890-1234', '468 ถนนนครศรี ตำบลทุ่งใหญ่ อำเภอเมือง นครศรีธรรมราช 80000', 'นครศรีธรรมราช', 'เมือง', 'ทุ่งใหญ่', '80000', 8.4854, 99.9181],
    ['NST018', 'สมนึก ใจสุข', '098-901-2345', '579 ถนนธรรมราช ตำบลขนอม อำเภอเมือง นครศรีธรรมราช 80000', 'นครศรีธรรมราช', 'เมือง', 'ขนอม', '80000', 8.4904, 99.9231],
    ['NST019', 'สมโชค ใจเป็นสุข', '099-012-3456', '680 ถนนกิ่งแก้ว ตำบลหัวไผ่ อำเภอเมือง นครศรีธรรมราช 80000', 'นครศรีธรรมราช', 'เมือง', 'หัวไผ่', '80000', 8.4954, 99.9281],
    ['NST020', 'สมบัติ ใจรำรวย', '080-123-4567', '791 ถนนสีแก้ว ตำบลฉวาง อำเภอเมือง นครศรีธรรมราช 80000', 'นครศรีธรรมราช', 'เมือง', 'ฉวาง', '80000', 8.4004, 99.9631],
    ['NST021', 'สมบูรณ์ ใจแจ่ม', '081-234-5678', '892 ถนนชนะเขต ตำบลบ้านนา อำเภอเมือง นครศรีธรรมราช 80000', 'นครศรีธรรมราช', 'เมือง', 'บ้านนา', '80000', 8.4324, 99.9651],
    ['NST022', 'สมเพชร ใจหนัก', '082-345-6789', '103 ถนนคลัง ตำบลเขาใหญ่ อำเภอเมือง นครศรีธรรมราช 80000', 'นครศรีธรรมราช', 'เมือง', 'เขาใหญ่', '80000', 8.4274, 99.9701],
    ['NST023', 'สมพิศ ใจงาม', '083-456-7890', '214 ถนนจำลอง ตำบลหนองหงส์ อำเภอเมือง นครศรีธรรมราช 80000', 'นครศรีธรรมราช', 'เมือง', 'หนองหงส์', '80000', 8.4374, 99.9611],
    ['NST024', 'สมรอง ใจรัก', '084-567-8901', '325 ถนนราชดำเนิน ตำบลปากแพง อำเภอเมือง นครศรีธรรมราช 80000', 'นครศรีธรรมราช', 'เมือง', 'ปากแพง', '80000', 8.4424, 99.9561],
    ['NST025', 'สมร่วง ใจเซา', '085-678-9012', '436 ถนนธรรมราช ตำบลบ้านนิคม อำเภอเมือง นครศรีธรรมราช 80000', 'นครศรีธรรมราช', 'เมือง', 'บ้านนิคม', '80000', 8.4224, 99.9751],
    ['NST026', 'สมศรี ใจสวย', '086-789-0123', '547 ถนนเสด็จ ตำบลเขาเจียก อำเภอเมือง นครศรีธรรมราช 80000', 'นครศรีธรรมราช', 'เมือง', 'เขาเจียก', '80000', 8.4174, 99.9501],
    ['NST027', 'สมสุข ใจดี', '087-890-1234', '658 ถนนสำโรง ตำบลโคกไผ่ อำเภอเมือง นครศรีธรรมราช 80000', 'นครศรีธรรมราช', 'เมือง', 'โคกไผ่', '80000', 8.4474, 99.9801],
    ['NST028', 'สมหวัง ใจเพิ่ม', '088-901-2345', '769 ถนนกิ่งแก้ว ตำบลฉวาง อำเภอเมือง นครศรีธรรมราช 80000', 'นครศรีธรรมราช', 'เมือง', 'ฉวาง', '80000', 8.4524, 99.9851],
    ['NST029', 'สมอารมณ์ ใจเด็ด', '089-012-3456', '870 ถนนธานี ตำบลกำแพงเพชร อำเภอเมือง นครศรีธรรมราช 80000', 'นครศรีธรรมราช', 'เมือง', 'กำแพงเพชร', '80000', 8.4624, 99.9451],
    ['NST030', 'สมอาจ ใจเด็ด', '090-123-4567', '981 ถนนนครศรี ตำบลแหลมตะลุมพุก อำเภอเมือง นครศรีธรรมราช 80000', 'นครศรีธรรมราช', 'เมือง', 'แหลมตะลุมพุก', '80000', 8.4574, 99.9401]
];

function insertSampleData() {
    global $conn;
    
    $inserted = 0;
    $skipped = 0;
    $errors = [];
    
    foreach ($sample_addresses as $address) {
        try {
            // Check if AWB already exists
            $stmt = $conn->prepare("SELECT id FROM delivery_address WHERE awb_number = ?");
            $stmt->execute([$address[0]]);
            
            if ($stmt->fetch()) {
                $skipped++;
                continue;
            }
            
            // Insert new record
            $stmt = $conn->prepare("INSERT INTO delivery_address (awb_number, recipient_name, recipient_phone, address, province, district, subdistrict, postal_code, latitude, longitude, geocoding_status) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, 'success')");
            $stmt->execute([
                $address[0],  // AWB
                $address[1],  // Name
                $address[2],  // Phone
                $address[3],  // Address
                $address[4],  // Province
                $address[5],  // District
                $address[6],  // Subdistrict
                $address[7],  // Postal code
                $address[8],  // Latitude
                $address[9]   // Longitude
            ]);
            
            $inserted++;
            
        } catch (Exception $e) {
            $errors[] = "Error inserting " . $address[0] . ": " . $e->getMessage();
        }
    }
    
    return [
        'inserted' => $inserted,
        'skipped' => $skipped,
        'errors' => $errors
    ];
}

// Check if script is called directly
if (basename($_SERVER['PHP_SELF']) == basename(__FILE__)) {
    echo "<!DOCTYPE html>";
    echo "<html><head><title>Sample Data Import - นครศรีธรรมราช</title></head><body>";
    echo "<h1>Sample Data Import - นครศรีธรรมราช</h1>";
    
    if (isset($_GET['import'])) {
        echo "<h2>กำลังนำเข้าข้อมูลตัวอย่าง...</h2>";
        $result = insertSampleData();
        
        echo "<div style='background:#d4edda; padding:10px; border:1px solid #c3e6cb; margin:10px 0;'>";
        echo "<strong>ผลลัพธ์:</strong><br>";
        echo "เพิ่มเข้าระบบ: " . $result['inserted'] . " รายการ<br>";
        echo "ข้าม (มีอยู่แล้ว): " . $result['skipped'] . " รายการ<br>";
        echo "</div>";
        
        if (!empty($result['errors'])) {
            echo "<div style='background:#f8d7da; padding:10px; border:1px solid #f5c6cb; margin:10px 0;'>";
            echo "<strong>ข้อผิดพลาด:</strong><br>";
            foreach ($result['errors'] as $error) {
                echo "- " . htmlspecialchars($error) . "<br>";
            }
            echo "</div>";
        }
        
        echo "<a href='../pages/zone_analyzer.php' style='display:inline-block; padding:10px 20px; background:#007bff; color:white; text-decoration:none; border-radius:5px; margin-top:10px;'>ไปที่ระบบวิเคราะห์โซน</a>";
    } else {
        echo "<p>สคริปต์นี้จะนำเข้าข้อมูลตัวอย่าง 30 รายการ ที่อยู่ในจังหวัดนครศรีธรรมราช อำเภอเมือง พร้อมพิกัดสำหรับทดสอบระบบวิเคราะห์โซน</p>";
        echo "<a href='?import=1' style='display:inline-block; padding:10px 20px; background:#28a745; color:white; text-decoration:none; border-radius:5px;'>นำเข้าข้อมูลตัวอย่าง</a>";
    }
    
    echo "</body></html>";
}
?> 